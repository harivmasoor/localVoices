{"ast":null,"code":"import _objectSpread from\"/Users/harimasoor/Desktop/current/localVoices/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _regeneratorRuntime from\"/Users/harimasoor/Desktop/current/localVoices/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/harimasoor/Desktop/current/localVoices/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import csrfFetch from\"./csrf.js\";var SET_CURRENT_USER='session/setCurrentUser';var REMOVE_CURRENT_USER='session/removeCurrentUser';export var setCurrentUser=function setCurrentUser(user){return{type:SET_CURRENT_USER,payload:user};};var removeCurrentUser=function removeCurrentUser(){return{type:REMOVE_CURRENT_USER};};var storeCSRFToken=function storeCSRFToken(response){var csrfToken=response.headers.get(\"X-CSRF-Token\");if(csrfToken)sessionStorage.setItem(\"X-CSRF-Token\",csrfToken);};var storeCurrentUser=function storeCurrentUser(user){if(user)sessionStorage.setItem(\"currentUser\",JSON.stringify(user));else sessionStorage.removeItem(\"currentUser\");};export var login=function login(_ref){var credential=_ref.credential,password=_ref.password;return/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(dispatch){var response,data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return csrfFetch(\"/api/session\",{method:\"POST\",body:JSON.stringify({credential:credential,password:password})});case 2:response=_context.sent;_context.next=5;return response.json();case 5:data=_context.sent;storeCurrentUser(data.user);dispatch(setCurrentUser(data.user));return _context.abrupt(\"return\",response);case 9:case\"end\":return _context.stop();}},_callee);}));return function(_x){return _ref2.apply(this,arguments);};}();};export var restoreSession=function restoreSession(){return/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(dispatch){var response,data;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.next=2;return csrfFetch(\"/api/session\");case 2:response=_context2.sent;storeCSRFToken(response);_context2.next=6;return response.json();case 6:data=_context2.sent;storeCurrentUser(data.user);dispatch(setCurrentUser(data.user));return _context2.abrupt(\"return\",response);case 10:case\"end\":return _context2.stop();}},_callee2);}));return function(_x2){return _ref3.apply(this,arguments);};}();};export var signup=function signup(user){return/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(dispatch){var username,email,password,phone_number,response,data;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:username=user.username,email=user.email,password=user.password,phone_number=user.phone_number;_context3.next=3;return csrfFetch(\"/api/users\",{method:\"POST\",body:JSON.stringify({username:username,email:email,password:password,phone_number:phone_number})});case 3:response=_context3.sent;_context3.next=6;return response.json();case 6:data=_context3.sent;storeCurrentUser(data.user);dispatch(setCurrentUser(data.user));return _context3.abrupt(\"return\",response);case 10:case\"end\":return _context3.stop();}},_callee3);}));return function(_x3){return _ref4.apply(this,arguments);};}();};export var logout=function logout(){return/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(dispatch){var response;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1)switch(_context4.prev=_context4.next){case 0:_context4.next=2;return csrfFetch(\"/api/session\",{method:\"DELETE\"});case 2:response=_context4.sent;storeCurrentUser(null);dispatch(removeCurrentUser());return _context4.abrupt(\"return\",response);case 6:case\"end\":return _context4.stop();}},_callee4);}));return function(_x4){return _ref5.apply(this,arguments);};}();};var initialState={user:JSON.parse(sessionStorage.getItem(\"currentUser\")),isAuthenticated:!!JSON.parse(sessionStorage.getItem(\"currentUser\"))// This will be true if user exists and false otherwise\n};var sessionReducer=function sessionReducer(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:initialState;var action=arguments.length>1?arguments[1]:undefined;switch(action.type){case SET_CURRENT_USER:return _objectSpread(_objectSpread({},state),{},{user:action.payload,isAuthenticated:true});case REMOVE_CURRENT_USER:return _objectSpread(_objectSpread({},state),{},{user:null,isAuthenticated:false});default:return state;}};export default sessionReducer;","map":{"version":3,"names":["csrfFetch","SET_CURRENT_USER","REMOVE_CURRENT_USER","setCurrentUser","user","type","payload","removeCurrentUser","storeCSRFToken","response","csrfToken","headers","get","sessionStorage","setItem","storeCurrentUser","JSON","stringify","removeItem","login","_ref","credential","password","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","dispatch","data","wrap","_callee$","_context","prev","next","method","body","sent","json","abrupt","stop","_x","apply","arguments","restoreSession","_ref3","_callee2","_callee2$","_context2","_x2","signup","_ref4","_callee3","username","email","phone_number","_callee3$","_context3","_x3","logout","_ref5","_callee4","_callee4$","_context4","_x4","initialState","parse","getItem","isAuthenticated","sessionReducer","state","length","undefined","action","_objectSpread"],"sources":["/Users/harimasoor/Desktop/current/localVoices/frontend/src/store/session.js"],"sourcesContent":["import csrfFetch from \"./csrf.js\";\n\nconst SET_CURRENT_USER = 'session/setCurrentUser';\nconst REMOVE_CURRENT_USER = 'session/removeCurrentUser';\n\nexport const setCurrentUser = (user) => ({\n  type: SET_CURRENT_USER,\n  payload: user\n});\n\nconst removeCurrentUser = () => ({\n  type: REMOVE_CURRENT_USER\n});\n\nconst storeCSRFToken = response => {\n  const csrfToken = response.headers.get(\"X-CSRF-Token\");\n  if (csrfToken) sessionStorage.setItem(\"X-CSRF-Token\", csrfToken);\n}\n\nconst storeCurrentUser = user => {\n  if (user) sessionStorage.setItem(\"currentUser\", JSON.stringify(user));\n  else sessionStorage.removeItem(\"currentUser\");\n}\n\nexport const login = ({ credential, password }) => async dispatch => {\n  const response = await csrfFetch(\"/api/session\", {\n    method: \"POST\",\n    body: JSON.stringify({ credential, password })\n  });\n  const data = await response.json();\n  storeCurrentUser(data.user);\n  dispatch(setCurrentUser(data.user));\n  return response;\n};\n\nexport const restoreSession = () => async dispatch => {\n  const response = await csrfFetch(\"/api/session\");\n  storeCSRFToken(response);\n  const data = await response.json();\n  storeCurrentUser(data.user);\n  dispatch(setCurrentUser(data.user));\n  return response;\n};\n\nexport const signup = (user) => async (dispatch) => {\n  const { username, email, password, phone_number } = user;\n  const response = await csrfFetch(\"/api/users\", {\n    method: \"POST\",\n    body: JSON.stringify({\n      username,\n      email,\n      password,\n      phone_number\n    })\n  });\n  const data = await response.json();\n  storeCurrentUser(data.user);\n  dispatch(setCurrentUser(data.user));\n  return response;\n};\n\nexport const logout = () => async (dispatch) => {\n  const response = await csrfFetch(\"/api/session\", {\n    method: \"DELETE\"\n  });\n  storeCurrentUser(null);\n  dispatch(removeCurrentUser());\n  return response;\n};\n\nconst initialState = { \n  user: JSON.parse(sessionStorage.getItem(\"currentUser\")),\n  isAuthenticated: !!JSON.parse(sessionStorage.getItem(\"currentUser\")) // This will be true if user exists and false otherwise\n};\n\nconst sessionReducer = (state = initialState, action) => {\n  switch (action.type) {\n    case SET_CURRENT_USER:\n      return { ...state, user: action.payload, isAuthenticated: true };\n    case REMOVE_CURRENT_USER:\n      return { ...state, user: null, isAuthenticated: false };\n    default:\n      return state;\n  }\n};\n\nexport default sessionReducer;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}